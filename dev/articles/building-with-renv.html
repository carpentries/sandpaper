<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="sandpaper">
<title>Building Lessons With A Package Cache • sandpaper</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Building Lessons With A Package Cache">
<meta property="og:description" content="sandpaper">
<meta property="og:image" content="https://carpentries.github.io/sandpaper/logo.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@zkamvar">
<meta name="twitter:site" content="@thecarpentries">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">sandpaper</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.16.5.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/building-with-renv.html">Building Lessons With A Package Cache</a>
    <a class="dropdown-item" href="../articles/automated-pull-requests.html">Working with Automated Pull Requests</a>
    <a class="dropdown-item" href="../articles/include-child-documents.html">Including Child Documents</a>
    <a class="dropdown-item" href="../articles/translations.html">Translating The Workbench</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/index.html">More articles...</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/carpentries/sandpaper/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Building Lessons With A Package Cache</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/carpentries/sandpaper/blob/HEAD/vignettes/building-with-renv.Rmd" class="external-link"><code>vignettes/building-with-renv.Rmd</code></a></small>
      <div class="d-none name"><code>building-with-renv.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="quickstart">Quickstart<a class="anchor" aria-label="anchor" href="#quickstart"></a>
</h2>
<p>If you are working on a lesson that has content with generated
output, then this guide is for you. This will get you started using a
local package cache separate from your default library for your lessons
that ensure you can reproduce your lesson locally. The {sandpaper}
engine is mindful of lessons with generated content in the following
ways:</p>
<ul>
<li>
<em>reliable setup</em>: the version of the lesson built on the
carpentries website will be the same as what you build on your computer
because the packages will be identical</li>
<li>
<em>environmentally friendly</em>: The lesson dependencies are NOT
stored in your default R library and they will not alter your R
environment.</li>
<li>
<em>transparent</em>: any additions or deletions to the cache will
be recorded in the lockfile, which is tracked by git.</li>
</ul>
<p>To get started, you need to <em>explicitly</em> give {sandpaper}
permission to create and use a cache with the function
<code><a href="../reference/package_cache.html">use_package_cache()</a></code></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://carpentries.github.io/sandpaper/">"sandpaper"</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/package_cache.html">use_package_cache</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#| </span></span>
<span><span class="co">#| <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Caching Build Packages for Generated Content</span> <span style="color: #00BBBB;">────────────────────────</span></span></span>
<span><span class="co">#| The Carpentries lesson infrastructure uses the <span style="color: #0000BB;">renv</span> (R environment)</span></span>
<span><span class="co">#| package to maintain reproducibility for lessons with generated content.</span></span>
<span><span class="co">#| It looks like you have not yet used <span style="color: #0000BB;">renv</span> before, so <span style="font-weight: bold;">this is a one-time</span></span></span>
<span><span class="co">#| <span style="font-weight: bold;">message</span> that gives you information about how the package cache can help</span></span>
<span><span class="co">#| you with your lesson.</span></span>
<span><span class="co">#| </span></span>
<span><span class="co">#| <span style="color: #080808; background-color: #FFFFD7;">Finally, renv maintains a local cache of data on the filesystem,</span></span></span>
<span><span class="co">#| <span style="color: #080808; background-color: #FFFFD7;">located at:</span></span></span>
<span><span class="co">#| </span></span>
<span><span class="co">#| - "/path/to/cache"</span></span>
<span><span class="co">#| </span></span>
<span><span class="co">#| This path can be customized: please see the documentation in</span></span>
<span><span class="co">#| `?renv::paths`.</span></span>
<span><span class="co">#| </span></span>
<span><span class="co">#| → This may take some time to set up the first time you use it, but once</span></span>
<span><span class="co">#| the cache is established, the process will run much more quickly.</span></span>
<span><span class="co">#| </span></span>
<span><span class="co">#| If you choose not to use the package cache, be aware that you may find</span></span>
<span><span class="co">#| differences between the lesson you render on your computer and what is</span></span>
<span><span class="co">#| rendered online.</span></span>
<span><span class="co">#| </span></span>
<span><span class="co">#| <span style="font-weight: bold;">Do you want to using a package cache for Carpentries lessons?</span></span></span>
<span><span class="co">#| ── Enter your selection or press 0 to exit ─────────────────────────────</span></span>
<span><span class="co">#| 1: <span style="font-weight: bold;">Yes</span>, please use the package cache (recommended)</span></span>
<span><span class="co">#| 2: <span style="font-weight: bold;">No</span>, I want to use my default library</span></span></code></pre>
<blockquote>
<p>NOTE: If you have already used {renv} previously, then you will not
get this notification. Instead, you will get a notification that your
consent has already been provided.</p>
</blockquote>
<p>When you select <code>1</code> for yes, your global package cache
will be created by the {renv} package and sandpaper will automatically
detect and install any packages (and updates) needed for your lesson.
<strong>Once you have set up your cache, it can be used for <em>all</em>
of your lessons going forward.</strong></p>
<p>For example, let’s say you have a lesson that uses the {cowsay} and
{curl} packages to bring a random cat fact at the end of the lesson:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>::::::::::::::::::::::::::::::::::::: keypoints</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="ss">- </span>Use <span class="in">`.Rmd`</span> files for lessons even if you don"t need to generate any code</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="ss">- </span>Run <span class="in">`sandpaper::check_lesson()`</span> to identify any issues with your lesson</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="ss">- </span>Run <span class="in">`sandpaper::build_lesson()`</span> to preview your lesson locally</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>::::::::::::::::::::::::::::::::::::::::::::::::</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="in">```{r catfact, message=FALSE, echo=FALSE}</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="in">library(curl)</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="in">library(cowsay)</span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="in">say("catfact", "cat")</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>When you build your lesson, you will see this kind of output:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/build_lesson.html">build_lesson</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre class="output"><code><span><span class="co">#| ℹ Consent to use package cache provided</span></span>
<span><span class="co">#| → Searching for and installing available dependencies</span></span>
<span><span class="co">#| * Discovering package dependencies ... Done!</span></span>
<span><span class="co">#| * Copying packages into the library ... Done!</span></span>
<span><span class="co">#| * Resolving missing dependencies  ... </span></span>
<span><span class="co">#| Retrieving "https://cran.rstudio.com/src/contrib/cowsay_0.8.0.tar.gz" ...</span></span>
<span><span class="co">#|  OK [downloaded 564.5 Kb in 0.1 secs]</span></span>
<span><span class="co">#| Retrieving "https://cran.rstudio.com/src/contrib/crayon_1.4.1.tar.gz" ...</span></span>
<span><span class="co">#|  OK [downloaded 34.9 Kb in 0.1 secs]</span></span>
<span><span class="co">#| Retrieving "https://cran.rstudio.com/src/contrib/fortunes_1.5-4.tar.gz" ...</span></span>
<span><span class="co">#|  OK [downloaded 188.4 Kb in 0.1 secs]</span></span>
<span><span class="co">#| Retrieving "https://cran.rstudio.com/src/contrib/rmsfact_0.0.3.tar.gz" ...</span></span>
<span><span class="co">#|  OK [downloaded 10.5 Kb in 0.1 secs]</span></span>
<span><span class="co">#| Installing crayon [1.4.1] ...</span></span>
<span><span class="co">#|  OK [built from source]</span></span>
<span><span class="co">#| Copying crayon [1.4.1] into the cache ...</span></span>
<span><span class="co">#|  OK [copied to cache in 5.9 milliseconds]</span></span>
<span><span class="co">#| Installing fortunes [1.5-4] ...</span></span>
<span><span class="co">#|  OK [built from source]</span></span>
<span><span class="co">#| Copying fortunes [1.5-4] into the cache ...</span></span>
<span><span class="co">#|  OK [copied to cache in 5.6 milliseconds]</span></span>
<span><span class="co">#| Installing rmsfact [0.0.3] ...</span></span>
<span><span class="co">#|  OK [built from source]</span></span>
<span><span class="co">#| Copying rmsfact [0.0.3] into the cache ...</span></span>
<span><span class="co">#|  OK [copied to cache in 5.7 milliseconds]</span></span>
<span><span class="co">#| Installing cowsay [0.8.0] ...</span></span>
<span><span class="co">#|  OK [built from source]</span></span>
<span><span class="co">#| Copying cowsay [0.8.0] into the cache ...</span></span>
<span><span class="co">#|  OK [copied to cache in 7.5 milliseconds]</span></span>
<span><span class="co">#| → Restoring any dependency versions</span></span>
<span><span class="co">#| * The library is already synchronized with the lockfile.</span></span>
<span><span class="co">#| → Recording changes in lockfile</span></span>
<span><span class="co">#| The following package(s) will be updated in the lockfile:</span></span>
<span><span class="co">#| </span></span>
<span><span class="co">#| # CRAN ===============================</span></span>
<span><span class="co">#| - cowsay     [* -&gt; 0.8.0]</span></span>
<span><span class="co">#| - crayon     [* -&gt; 1.4.1]</span></span>
<span><span class="co">#| - curl       [* -&gt; 4.3.2]</span></span>
<span><span class="co">#| - fortunes   [* -&gt; 1.5-4]</span></span>
<span><span class="co">#| - rmsfact    [* -&gt; 0.0.3]</span></span>
<span><span class="co">#| </span></span>
<span><span class="co">#| * Lockfile written to "/path/to/lesson/renv/profiles/lesson-requirements/renv.lock".</span></span>
<span><span class="co">#| ℹ Using package cache in /path/to/cache</span></span>
<span><span class="co">#| </span></span>
<span><span class="co">#| [ truncated ]</span></span></code></pre>
<p>The output will use the newly downloaded packages:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>::::::::::::::::::::::::::::::::::::: keypoints</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="ss">- </span>Use <span class="in">`.Rmd`</span> files for lessons even if you don"t need to generate any code</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="ss">- </span>Run <span class="in">`sandpaper::check_lesson()`</span> to identify any issues with your lesson</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="ss">- </span>Run <span class="in">`sandpaper::build_lesson()`</span> to preview your lesson locally</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>::::::::::::::::::::::::::::::::::::::::::::::::</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="in">```{.output}</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="in"> -------------- </span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a><span class="in">A cat can’t climb head first down a tree because every claw on a cat’s paw points the same way. To get down from a tree, a cat must back down.</span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a><span class="in"> --------------</span></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a><span class="in">    \</span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a><span class="in">      \</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a><span class="in">        \</span></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a><span class="in">            |\___/|</span></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a><span class="in">          ==) ^Y^ (==</span></span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a><span class="in">            \  ^  /</span></span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a><span class="in">             )=*=(</span></span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a><span class="in">            /     \</span></span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a><span class="in">            |     |</span></span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a><span class="in">           /| | | |\</span></span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a><span class="in">           \| | |_|/\</span></span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a><span class="in">      jgs  //_// ___/</span></span>
<span id="cb7-26"><a href="#cb7-26" tabindex="-1"></a><span class="in">               \_)</span></span>
<span id="cb7-27"><a href="#cb7-27" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb7-28"><a href="#cb7-28" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<div class="section level3">
<h3 id="temporarily-turning-off-the-cache">Temporarily Turning Off the Cache<a class="anchor" aria-label="anchor" href="#temporarily-turning-off-the-cache"></a>
</h3>
<p>There are times when you might want to not use the cache for a
lesson. To do this you can use <code><a href="../reference/package_cache.html">no_package_cache()</a></code> and your
lesson will default to using your local library.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/package_cache.html">no_package_cache</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">sandpaper</span><span class="fu">:::</span><span class="fu"><a href="../reference/build_markdown.html">build_markdown</a></span><span class="op">(</span>rebuild <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre class="output"><code><span></span>
<span><span class="co">#| ℹ Consent to use package cache not given. Using default library.</span></span>
<span><span class="co">#| → use `use_package_cache()` to enable the package cache for reproducible builds.</span></span>
<span><span class="co">#| → You can switch between using your cache and the default library with `options(sandpaper.use_renv = TRUE)` (`FALSE` for the default library)</span></span>
<span><span class="co">#| </span></span>
<span><span class="co">#| [ truncated ]</span></span></code></pre>
<p>The output will use packages if they are available, but throw errors
if they do not exist:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>::::::::::::::::::::::::::::::::::::: keypoints</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="ss">- </span>Use <span class="in">`.Rmd`</span> files for lessons even if you don"t need to generate any code</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="ss">- </span>Run <span class="in">`sandpaper::check_lesson()`</span> to identify any issues with your lesson</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="ss">- </span>Run <span class="in">`sandpaper::build_lesson()`</span> to preview your lesson locally</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>::::::::::::::::::::::::::::::::::::::::::::::::</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="in">```{.error}</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="in">Error in library(cowsay): there is no package called "cowsay"</span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="in">```{.error}</span></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a><span class="in">Error in say("catfact", "cat"): could not find function "say"</span></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>When you want to turn it on again, you can use
<code><a href="../reference/package_cache.html">use_package_cache()</a></code></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/package_cache.html">use_package_cache</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre class="output"><code><span><span class="co">#| ℹ Consent for renv provided---consent for package cache implied.</span></span></code></pre>
<p>Read on for information about how to add, update, and remove packages
from your cache.</p>
</div>
</div>
<div class="section level2">
<h2 id="motivation">Motivation<a class="anchor" aria-label="anchor" href="#motivation"></a>
</h2>
<p>One of the biggest motivations for building the lesson infrastructure
around {sandpaper} is to be mindful of how we build lessons with
generated content. For the moment, these are explicitly R Markdown
lessons, but in the future, it is possible for us to expand to different
engines <em>without changing your lesson’s</em> setup.</p>
<p>In the past, we’ve done this by including a script inside the lesson
template that would automatically scan the dependencies of your lesson
and install them to your computer. While convenient, there were
drawbacks to this method in that it would alter your personal R library
if any of the packages update, which was not good if you were using R
for you own work and wanted to preserve the package versions that you
had.</p>
<p>The ‘renv’ package provides a very useful interface to bring one
aspect of reproducibility to R projects. Because people working on
Carpentries lessons are also working academics and will likely have
projects on their computer where the package versions are necessary for
their work, it’s important that those environments are respected.</p>
<p>Our flavor of renv applies a package cache explicitly to the content
of the lesson, but does not impose itself as the default renv
environment.</p>
<p>This provisioner will do the following steps:</p>
<ol style="list-style-type: decimal">
<li><p>check for consent to use the package cache via
‘use_package_cache()’ and prompt for it if needed</p></li>
<li><p>check if the profile has been created and create it if needed via
‘renv::init()’</p></li>
<li><p>populate the cache with packages needed from the user’s system
and download any that are missing via ‘renv::hydrate()’. This includes
all new packages that have been added to the lesson.</p></li>
<li><p>If there is a lockfile already present, make sure the packages in
the cache are aligned with the lockfile (downloading sources if needed)
via ‘renv::restore()’.</p></li>
<li><p>Record the state of the cache in a lockfile tracked by git. This
will include adding new packages and removing old packages.
‘renv::snapshot()’</p></li>
</ol>
<p>When the lockfile changes, you will see it in git and have the power
to either commit or restore those changes.</p>
</div>
<div class="section level2">
<h2 id="rebuild-with-the-package-cache">Rebuild with the Package Cache<a class="anchor" aria-label="anchor" href="#rebuild-with-the-package-cache"></a>
</h2>
<p>By default, {sandpaper} will only rebuild files that have changed in
content. This is designed to minmize the time spent rebuilding your
lesson when you are actively writing it. If you are using the package
cache, this fact will remain true <em>even if the lockfile changes</em>.
Again, this is designed to minimize the time spent rebuilding the lesson
when you add unrelated, adjacent packages to your lesson.</p>
<p>On continuous integration (cloud deployment), any change in the
lockfile will cause the lesson to rebuild itself to make sure that the
deployed version of the lesson matches with the source of truth for the
lockfile.</p>
<p>The function that controls this behavior is called
<code><a href="../reference/package_cache.html">package_cache_trigger()</a></code> when you call it without any
arguments, it will report <code>TRUE</code> or <code>FALSE</code>,
indicating if changes to the lockfile will trigger a rebuild or not,
respectively:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/package_cache.html">package_cache_trigger</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#| [1] FALSE</span></span>
<span><span class="fu"><a href="../reference/package_cache.html">package_cache_trigger</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span> <span class="co"># set the package cache to auto-trigger rebuilds</span></span>
<span><span class="co">#| [1] TRUE</span></span>
<span><span class="fu"><a href="../reference/package_cache.html">package_cache_trigger</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="co"># prevent package cache from triggering rebuilds</span></span>
<span><span class="co">#| [1] FALSE</span></span></code></pre></div>
<p>You might want to set this to <code>TRUE</code> when you pull changes
from upstream.</p>
</div>
<div class="section level2">
<h2 id="adding-new-packages-to-the-cache">Adding New Packages to the Cache<a class="anchor" aria-label="anchor" href="#adding-new-packages-to-the-cache"></a>
</h2>
<p>The {sandpaper} cache records ONLY the packages needed for the
repository itself. This means that if you want to use a package, you
<em>must</em> have it declared somewhere within your lesson either as
<code><a href="https://rdrr.io/r/base/library.html" class="external-link">library(package)</a></code> or <code>package::function()</code>.</p>
<p>For example, if I wanted to use the <code>sessioninfo</code> package
to create a record at the end of an episode, I would only need to add
the following chunk:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="in">```{r sessioninfo, echo = FALSE}</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="in">sessioninfo::session_info()</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>From there, {sandpaper} will be able to detect the package and add it
to the cache.</p>
<blockquote>
<p>Note: {renv} can not detect packages that are programmatically
loaded, so one workaround is to have a file called
<code>episodes/install.R</code> that lists the installation scripts for
the packages in your lesson</p>
</blockquote>
<p>If you want to pin a package to a specific version, read on.</p>
</div>
<div class="section level2">
<h2 id="pinning-specific-package-versions">Pinning Specific Package Versions<a class="anchor" aria-label="anchor" href="#pinning-specific-package-versions"></a>
</h2>
<p>To pin a specific package version (e.g. the newest version has
breaking changes you want to work on before release), you can use the
<code><a href="../reference/dependency_management.html">pin_version()</a></code> function. For example, here’s how you would
pin the {cowsay} package to version 0.7.0:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dependency_management.html">pin_version</a></span><span class="op">(</span><span class="st">"cowsay@0.7.0"</span><span class="op">)</span></span></code></pre></div>
<p>This will record the package in the lockfile so that the next time
<code><a href="../reference/dependency_management.html">manage_deps()</a></code> runs, it will use the correct version.</p>
</div>
<div class="section level2">
<h2 id="updating-the-cache">Updating the Cache<a class="anchor" aria-label="anchor" href="#updating-the-cache"></a>
</h2>
<p>If you want to update the packages in the package cache, you can use
the function <code><a href="../reference/dependency_management.html">update_cache()</a></code>. This requires an internet
connection and will scan the packages in your lesson for any potential
updates and ask if you want to update them. This will update those
packages in your package cache and your lockfile.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dependency_management.html">update_cache</a></span><span class="op">(</span>prompt <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Robert Davey, Erin Becker, Zhian N. Kamvar, Joel H. Nitta.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
