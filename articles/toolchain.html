<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="sandpaper">
<title>The nerd's guide to the lesson toolchain • sandpaper</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="The nerd's guide to the lesson toolchain">
<meta property="og:description" content="sandpaper">
<meta property="og:image" content="https://carpentries.github.io/sandpaper/logo.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@zkamvar">
<meta name="twitter:site" content="@thecarpentries">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">sandpaper</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/building-with-renv.html">Building Lessons With A Package Cache</a>
    <a class="dropdown-item" href="../articles/automated-pull-requests.html">Working with Automated Pull Requests</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/index.html">More articles...</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/carpentries/sandpaper/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="toolchain_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>The nerd's guide to the lesson toolchain</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/carpentries/sandpaper/blob/HEAD/vignettes/articles/toolchain.Rmd" class="external-link"><code>vignettes/articles/toolchain.Rmd</code></a></small>
      <div class="d-none name"><code>toolchain.Rmd</code></div>
    </div>

    
    
<p>This document will explore the tools needed to build the lessons and how they are connected, but it will not go into detail about HOW these work. Before we start, it’s worthwhile to take a step back and analyze what we are doing exactly. At the very core, we want to be able to take a bunch of markdown files, translate them to HTML and stick them into an HTML template. This is also known as static site generation and there are <a href="https://staticsitegenerators.net/" class="external-link">more than 450 static site generators available</a>.</p>
<p>In the past, we have relied on <a href="https://jekyllrb.com/" class="external-link">Jekyll</a>, which is a static site generator that has been the back-end engine for GitHub pages for many years now. The problems we face with this setup are that it was difficult to update the style of the lesson because it would require a pull request and often some merge conflict resolution, people would need to have Git, GNU Make, Ruby, Python, and BASH installed in order to render the lesson locally, and contributors and maintainers would need to learn the highly specialized <a href="https://kramdown.gettalong.org/quickref.html" class="external-link">kramdown</a> and <a href="https://shopify.github.io/liquid/" class="external-link">liquid</a> template tags.</p>
<p>Our proposed toolchain is designed to be modular and used by both lesson maintainers and work on the back-end systems with clear requirements. It will be based on the R programming language and will abide by the following rules:</p>
<ol style="list-style-type: decimal">
<li>Lesson contributors do not need to know anything about the toolchain to contribute in a meaningful way</li>
<li>Elements of the toolchain that evaluates, validates, and stylizes should live in separate repositories to allow for seamless updating</li>
<li>The procedures should be well-documented and generalizable enough that the toolchain is not entirely dependent on R.</li>
</ol>
<p>R is beneficial because it already has a mature ecosystem of packages for publishing reports and web content from markdown, it works on all platforms, and we teach it as part of our core curriculum.</p>
<p>Below is a diagram that describes the relationships between different tools in our proposed toolchain.</p>
<div class="figure">
<img src="img/broad-flow.dot.svg" alt=""><p class="caption">Diagrammatic representation of the proposed toolchain (excluding GitHub). Lavender rectangles represent R packages, Plum rectangles represent interchangable tools, Powder Blue Ovals represent people.</p>
</div>
<div class="section level2">
<h2 id="basic-infrastructure-for-maintainers">Basic Infrastructure for Maintainers<a class="anchor" aria-label="anchor" href="#basic-infrastructure-for-maintainers"></a>
</h2>
<p>To manage and render lessons, you need to have the following software installed. All dependencies for the R packages should automatically install.</p>
<ul>
<li>Required
<ul>
<li>
<a href="https://cran.r-project.org/" class="external-link">R</a> (&gt;= 3.0.1) and associated packages:
<ul>
<li><a href="https://zkamvar.github.io/sandpaper/" class="external-link">{sandpaper}</a></li>
<li><a href="https://github.com/zkamvar/varnish#readme" class="external-link">{varnish}</a></li>
</ul>
</li>
<li>
<a href="https://rstudio.com/products/rstudio/download/#download" class="external-link">RStudio</a> (&gt;= 1.4) OR <a href="https://pandoc.org/installing.html" class="external-link">pandoc</a> (&gt;= 2.11)</li>
<li>A Modern Web Browser</li>
</ul>
</li>
<li>Recommended
<ul>
<li>Git (&gt;= 2.0)</li>
<li><a href="https://rstudio.github.io/renv/" class="external-link">{renv}</a></li>
</ul>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="the-source-of-truth-dependency-management">The Source of Truth: Dependency Management<a class="anchor" aria-label="anchor" href="#the-source-of-truth-dependency-management"></a>
</h2>
<p>Both the Python and the R package ecosystem are constantly evolving, which can often create different outputs from one maintainer’s computer to the other. Moreover, if you maintain a lesson, you may not want to update a package that you are using for your thesis work. To alleviate these problems, we will use the <a href="https://rstudio.github.io/renv/" class="external-link">{renv}</a> R package for managing dependencies in the lessons.</p>
<p>When managing dependencies, <a href="https://rstudio.github.io/renv/" class="external-link">{renv}</a> serves two roles:</p>
<dl>
<dt>Package discovery</dt>
<dd>
<a href="https://rstudio.github.io/renv/" class="external-link">{renv}</a> will scan the packages declared in your lesson and install them to your computer Package management
</dd>
<dd>Lessons that use <a href="https://rstudio.github.io/renv/" class="external-link">{renv}</a> maintains a custom lockfile that contains only the packages required to build the lesson itself at specific versions, ensuring that the lesson can be reliably reproduced across computers.
</dd>
</dl>
<p>At this point, we should not that <a href="https://rstudio.github.io/renv/" class="external-link">{renv}</a> is <em>not required</em> for building a lesson even if it has generated content. You can find out more about how we use <a href="https://rstudio.github.io/renv/" class="external-link">{renv}</a> in the build process by reading the <a href="building-with-renv.html">Building Lessons with a Package Cache</a> vignette.</p>
<div class="section level3">
<h3 id="for-markdown-only-lessons">For Markdown-Only Lessons<a class="anchor" aria-label="anchor" href="#for-markdown-only-lessons"></a>
</h3>
<p>If you have a markdown-only lesson with no evaluated code (that is, you copy and paste the output the learners should see), then you do not need to worry about dependency management beyond the basic infrastructure (which will be taken care of automatically).</p>
</div>
<div class="section level3">
<h3 id="for-rmarkdown-lessons-r-bash-python-sql">For RMarkdown Lessons (R, BASH, Python, SQL)<a class="anchor" aria-label="anchor" href="#for-rmarkdown-lessons-r-bash-python-sql"></a>
</h3>
<p>If your lesson uses RMarkdown to evaluate code and produce output, then it is of the utmost importance that the dependencies are managed properly in the lesson. Like the Jekyll-based lesson template, we will take care of making sure the dependencies are okay, but the only difference here is that we will now ask you to approve them so that everyone has the same experience.</p>
<p>While the {renv} package has a relatively stripped-down interface, we wanted to provide an opinionated solution to management. For example, our learners are advised to install <a href="https://www.anaconda.com/download/#linux" class="external-link">anaconda</a>, which we also encourage and recommend.</p>
<p>The {renv} package is aware of both R and Python dependencies, so you can install and add packages to the lesson as usual and then run a single command <code>sandpaper::deps()</code> to check and update the dependencies.</p>
<p>Python dependencies will live in an <code>environment.yml</code> file at the root of the lesson.</p>
<div class="warning">
<p>At the moment, this bit lives on shaky foundation</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="carpentries-specific-packages">Carpentries-Specific Packages<a class="anchor" aria-label="anchor" href="#carpentries-specific-packages"></a>
</h2>
<p>We have created three R packages that were designed to work explicitly with our lessons. These should be automatically installed by a special configuration file inside of the lesson repository.</p>
<div class="section level3">
<h3 id="lesson-template-sandpaper">Lesson Template ({sandpaper})<a class="anchor" aria-label="anchor" href="#lesson-template-sandpaper"></a>
</h3>
<p>The <a href="https://zkamvar.github.io/sandpaper" class="external-link">{sandpaper}</a> package creates and curates the lesson template. It is the only package that the maintainers of the lesson template need to interface with. The majority of maintainers need only one function: <code><a href="../reference/build_lesson.html">build_lesson()</a></code>, which will evaluate all new content and render it to an HTML page on their local machine.</p>
<div class="section level4">
<h4 id="i-key-packages">[i] Key Packages<a class="anchor" aria-label="anchor" href="#i-key-packages"></a>
</h4>
<p>The {sandpaper} package relies heavily on a few packages internally to make sure that we do not reinvent the wheel too much and that we gain the benefits from their tests:</p>
<div class="figure">
<img src="https://imgur.com/SpbwuzN.png" alt=""><p class="caption">workflow for sandpaper</p>
</div>
<ul>
<li>
<a href="https://pkgdown.r-lib.org" class="external-link">{pkgdown}</a> provides a scaffolding for us to be able to wrap our HTML (translated from markdown) and metadata in a framework that can live separately from the lesson template.</li>
<li>
<a href="https://yihui.org/knitr/" class="external-link">{knitr}</a> is the engine that we use to translate RMarkdown to Markdown without styling the output document.</li>
<li>
<a href="https://rmarkdown.rstudio.com/" class="external-link">{rmarkdown}</a> provides functions that give us access to pandoc. At the moment, the only function we use from RMarkdown is <code>pandoc_convert()</code> to transform markdown to HTML.</li>
<li>
<a href="https://usethis.r-lib.org" class="external-link">{usethis}</a> provides user interface functions for creating projects and working with github.</li>
<li>
<a href="https://gert.r-lib.org" class="external-link">{gert}</a> gives users access to git from R without the need for having it installed.</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="i-html-template-varnish">[i] HTML Template ({varnish})<a class="anchor" aria-label="anchor" href="#i-html-template-varnish"></a>
</h3>
<p>The <a href="https://github.com/zkamvar/varnish#readme" class="external-link">{varnish}</a> package contains the template HTML written in <a href="https://mustache.github.io/mustache.5.html" class="external-link">{{mustache}} templating language</a>. It is used by {sandpaper}, but not explicitly imported so that updating can be done inside R.</p>
<div class="section level4">
<h4 id="framework">Framework<a class="anchor" aria-label="anchor" href="#framework"></a>
</h4>
<div class="info">
<p>NOTE: This section needs more work and information.</p>
</div>
<p>The framework inside {varnish} needs to be extensible and, most importantly, separate for the logic needed to create the source documents. At the moment, we are using a <a href="https://getboostrap.org" class="external-link">bootstrap version 3</a>, but <a href="https://github.com/twbs/release" class="external-link">this version has officially been deprecated for the last two years.</a>. At the moment, there are two frameworks widely used within the R community, bootstrap, and <a href="https://rstudio.github.io/distill/" class="external-link">distill</a>. The benefits of distill is that it’s really nice for including citation metadata, but one of the downsides is that it absolutely requires JavaScript to be enabled (which can be a security risk).</p>
</div>
</div>
<div class="section level3">
<h3 id="i-lesson-validation-and-transformation-pegboard">[i] Lesson Validation and Transformation ({pegboard})<a class="anchor" aria-label="anchor" href="#i-lesson-validation-and-transformation-pegboard"></a>
</h3>
<p>The <a href="https://carpentries.github.io/pegboard" class="external-link">{pegboard}</a> package uses the <a href="https://docs.ropensci.org/tinkr" class="external-link">{tinkr}</a> package to read in markdown as XML and validate the structure against our schema to validate the internal structure of the lessons.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Zhian N. Kamvar.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
